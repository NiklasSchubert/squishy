{% extends 'base.html' %}

{% block title %}Add Profile - Squishy{% endblock %}

{% block content %}
<div class="profile-form">
    <h1>Add New Profile</h1>
    
    <form method="post">
        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required>
        </div>
        
        <div class="form-group">
            <label for="resolution">Resolution</label>
            <select id="resolution" name="resolution" required>
                <option value="3840x2160">4K (3840x2160)</option>
                <option value="1920x1080">1080p (1920x1080)</option>
                <option value="1280x720">720p (1280x720)</option>
                <option value="854x480">480p (854x480)</option>
                <option value="640x360">360p (640x360)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="codec">Codec</label>
            <select id="codec" name="codec" required>
                <option value="h264">H.264 (AVC)</option>
                <option value="hevc">H.265 (HEVC)</option>
                <option value="av1">AV1</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="container">Container</label>
            <select id="container" name="container" required>
                <option value="mkv">MKV</option>
                <option value="mp4">MP4</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="quality">Quality</label>
            <select id="quality" name="quality" required>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="bitrate">Bitrate (optional)</label>
            <input type="text" id="bitrate" name="bitrate" placeholder="e.g. 5M">
        </div>
        
        <div class="form-group">
            <label for="hw_accel">Hardware Acceleration</label>
            <select id="hw_accel" name="hw_accel">
                <option value="inherit" selected>Inherit Default</option>
                <option value="">None (Software Encoding)</option>
                <option value="nvenc">NVIDIA NVENC</option>
                <option value="qsv">Intel QuickSync (QSV)</option>
                <option value="vaapi">VAAPI (Intel/AMD GPU)</option>
                <option value="videotoolbox">VideoToolbox (macOS)</option>
                <option value="amf">AMD AMF</option>
            </select>
            <p class="help-text">Select a hardware acceleration method to speed up transcoding. "Inherit Default" will use the global hardware acceleration settings.</p>
        </div>
        
        <div class="form-group" id="hw_device_group" style="display:none;">
            <label for="hw_device">Hardware Device</label>
            <input type="text" id="hw_device" name="hw_device" placeholder="e.g. /dev/dri/renderD128 or 0">
            <p class="help-text">For CUDA/NVENC: GPU index (e.g. "0"). For VAAPI: device path (e.g. "/dev/dri/renderD128").</p>
        </div>
        
        <div class="form-actions">
            <button type="submit">Save Profile</button>
            <a href="{{ url_for('admin.list_profiles') }}" class="button secondary">Cancel</a>
        </div>
        
<script>
document.addEventListener('DOMContentLoaded', function() {
    const hwAccelSelect = document.getElementById('hw_accel');
    const hwDeviceGroup = document.getElementById('hw_device_group');
    
    hwAccelSelect.addEventListener('change', function() {
        // Show device field only for methods that need it
        if (this.value === 'nvenc' || this.value === 'cuda' || this.value === 'vaapi') {
            hwDeviceGroup.style.display = 'block';
        } else {
            hwDeviceGroup.style.display = 'none';
            // Clear the device input if not using a supported method
            if (this.value === 'inherit' || this.value === '') {
                document.getElementById('hw_device').value = '';
            }
        }
    });
});
</script>
    </form>
</div>
{% endblock %}